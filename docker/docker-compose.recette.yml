# Override Docker Compose pour la RECETTE (locale)
# Usage: docker compose -f docker-compose.yml -f docker-compose.recette.yml --env-file .env.recette up -d
#
# Ce fichier surcharge docker-compose.yml pour la recette locale :
#  - PostgreSQL : port 5433 sur localhost (évite conflit avec dev sur 5435)
#  - Backend    : variables d'environnement recette
#  - Nginx      : port 8082 sur localhost (évite conflit avec preprod 8080)

version: "3.9"

services:
  postgres:
    ports:
      - "127.0.0.1:5433:5432"
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:?POSTGRES_PASSWORD est requis}

  backend:
    environment:
      DATABASE_URL: postgres://wavy:${POSTGRES_PASSWORD:?POSTGRES_PASSWORD est requis}@postgres:5432/wavy
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:8082}
      JWT_SECRET: ${JWT_SECRET:?JWT_SECRET est requis}
      RESEND_API_KEY: ${RESEND_API_KEY:-}
    restart: always

  frontend:
    restart: always

  nginx:
    ports:
      - "127.0.0.1:8082:80"
    restart: always
